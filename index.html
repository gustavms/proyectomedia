<!DOCTYPE HTML>
<html>
<head>
<meta charset="UTF-8">
<title>Media Project</title>
<script>
var ultimopostdecadapagina = [];
var paginas5minutos =[{id:71263708835, urlface:"https://www.facebook.com/elcomercio.pe",url:"https://www.facebook.com/elcomercio.pe",pais:"Peru",nombre:"Comercio",hastag:"@Diario El Comercio (Perú)" }, //5minutos
                     {id:32813056753, urlface:"https://www.facebook.com/rppnoticias",url:"https://www.facebook.com/elcomercio.pe",pais:"Peru",nombre:"Rpp Noticias", hastag:"@RPP Noticias"},//5minutos
                     {id:57527494924, urlface:"https://www.facebook.com/CorreoPeru",url:"http://diariocorreo.pe",pais:"Peru",nombre:"Correo", hastag:"@Diario Correo"},//5minutos
                     {id:94604237016, urlface:"https://www.facebook.com/larepublicape",url:"http://larepublica.pe",pais:"Peru",nombre:"La Republica", hastag:"@Diario La República" },//5minutos
                     {id:50842855867, urlface:"https://www.facebook.com/peru21",url:"http://peru21.pe",pais:"Peru",nombre:"Peru21", hastag:"@Perú21.pe" },//5minutos
                     {id:102734169764795, urlface:"https://www.facebook.com/Tromepe",url:"http://trome.pe/",pais:"Peru",nombre:"Trome", hastag:"@Trome" },//5minutos
                     {id:183538434997743, urlface:"https://www.facebook.com/Gestionpe",url:"http://gestion.pe",pais:"Peru",nombre:"Gestion]", hastag:"@Diario Gestión" },//5minutos
                     {id:174837395908068, urlface:"https://www.facebook.com/publimetrope",url:"http://publimetro.pe",pais:"Peru",nombre:"Publimetro", hastag:"@Publimetro" }//5minutos

                  ];

                var paginas15minutos =[{id:97984508920, urlface:"https://www.facebook.com/DiarioOjo",url:"http://ojo.pe/",pais:"Peru",nombre:"Diario Ojo", hastag:"@Diario Ojo" },//cada 15minutos
                                       {id:143959365656931, urlface:"https://www.facebook.com/diario.expreso",url:"http://www.expreso.com.pe/",pais:"Peru",nombre:"Diario Expreso", hastag:"@Diario Expreso" }, //cada 15minutos
                                       {id:202297179961677, urlface:"https://www.facebook.com/elshowperu",url:"http://elshow.pe/",pais:"Peru",nombre:"Diario Expreso", hastag:"@Diario Expreso" }, //cada 15minutos
                                       {id:611091235574314, urlface:"https://www.facebook.com/SEMANAeconomica",url:"http://semanaeconomica.com/",pais:"Peru",nombre:"Semana Economica", hastag:"@SEMANAeconómica" },

                                       {id:1105050716183235, urlface:"https://www.facebook.com/seriestv.peliculas",url:"http://laprensa.peru.com/",pais:"Peru",nombre:"La Prensa.pe", hastag:"@Series y Novelas" },//cada hora 9am 12pm
                                       {id:143959365656931, urlface:"https://www.facebook.com/diario.expreso",url:"http://www.expreso.com.pe/",pais:"Peru",nombre:"Diario Expreso", hastag:"@Diario Expreso" },
                                       {id:1466684106954251, urlface:"https://www.facebook.com/diariounolevano",url:"http://diariouno.pe/",pais:"Peru",nombre:"Diario Uno", hastag:"@Diario UNO - Lima Perú" },//cada hora 11am - 12pm
                                       {id:356259204423835, urlface:"https://www.facebook.com/NuevoSolPeru",url:"http://diarionuevosol.pe",pais:"Peru",nombre:"Diario Nuevo Sol", hastag:"@Diario Nuevo Sol" },//10 articulos cada 2 dias todos a la misma vez
                                       {id:671367792939507, urlface:"https://www.facebook.com/OjoPublico",url:"http://ojo-publico.com/",pais:"Peru",nombre:"Ojo Público", hastag:"@OjoPúblico" },//cada dia
                                       {id:293890978996, urlface:"https://www.facebook.com/IDLReporteros",url:"https://idl-reporteros.pe",pais:"Peru",nombre:"IDL-Reporteros", hastag:"@IDL-Reporteros" },//cada dia
                                       {id:561717720516148, urlface:"https://www.facebook.com/ASBANCPeru",url:"http://www.asbanc.com.pe",pais:"Peru",nombre:"Asbanc", hastag:"@Asbanc - Asociación de Bancos del Perú" },//cada hora
                                       {id:611091235574314, urlface:"https://www.facebook.com/RumboEconomicoGlobal",url:"http://rumboeconomico.com",pais:"Peru",nombre:"Rumbo Economico", hastag:"@Rumbo Económico" }, //por verse
                                       {id:109939959032422, urlface:"https://www.facebook.com/agenciandina/",url:"http://www.andina.com.pe",pais:"Peru",nombre:"Andina", hastag:"@Agencia de Noticias Andina" },
                                       {id:561717720516148, urlface:"https://www.facebook.com/ASBANCPeru",url:"http://www.asbanc.com.pe",pais:"Peru",nombre:"Asbanc", hastag:"@Asbanc - Asociación de Bancos del Perú" },
                                       {id:611091235574314, urlface:"https://www.facebook.com/SEMANAeconomica",url:"http://semanaeconomica.com/",pais:"Peru",nombre:"Semana Economica", hastag:"@SEMANAeconómica" },// por verse cada media hora
                                       {id:293890978996, urlface:"https://www.facebook.com/IDLReporteros",url:"https://idl-reporteros.pe",pais:"Peru",nombre:"IDL-Reporteros", hastag:"@IDL-Reporteros" },
                                       {id:561717720516148, urlface:"https://www.facebook.com/ASBANCPeru",url:"http://www.asbanc.com.pe",pais:"Peru",nombre:"Asbanc", hastag:"@Asbanc - Asociación de Bancos del Perú" },
                                       {id:611091235574314, urlface:"https://www.facebook.com/RumboEconomicoGlobal",url:"http://rumboeconomico.com",pais:"Peru",nombre:"Ojo Público", hastag:"@OjoPúblico" }
                                        //2 articulos al dia ramdom

                                    ];
</script>

</head>
<body>
<p>Iniciar sesi&oacute;n con Facebook:cambio1</p>
<fb:login-button perms="email,user_birthday"></fb:login-button>
<script src="http://codeorigin.jquery.com/jquery-1.10.2.min.js"></script>


<script>
$(function() {
  $.ajax({

    //url: '//connect.facebook.net/en_US/sdk.js',
    url: '//connect.facebook.net/es_ES/all.js',
    dataType: 'script',
    cache: true,
    success: function() {
      alert('Facebook listo');
      FB.init({
        appId      : '1009400082482524',
        status     : true,
        xfbml      : true,
        version    : 'v2.8'
      });



function sacarpostyguardar(paginas){
  var ide;
    for (i in paginas){
       ide=paginas[i].id.toString();
       alert(ide);
       FB.api(ide,{"fields":"id,name,posts.limit(1){created_time,type,message,link,name,description,caption,full_picture,picture,status_type}"},
       function(response) {
          console.log(response);
          alert('Nombre: ' + response.name+" type :, url:"+ response.posts.data[0].link+", caption:" +response.posts.data[0].caption);

          console.log(response.posts);
          console.log(paginas[i].url.indexOf(response.posts[0].caption));
         if ((response.posts[0].type=="link") { //valida si es un post de enlace - no es video ni foto
             if (paginas[i].url.indexOf(response.posts.data[0].caption))  //es un articulo valido asi que envialo como en un post a nuestra servidor para analizar que tipo de articulo es ahi.

                 //hacer metodo httppost para enviar el post con todos los datos del response y los datos de pagina[i] todo en un json


             }
                       console.log("valio la condicion :"+response.posts);
                        alert('Nombre entro: ' + response.id+response.name+" :" );
         }

        } );
    }


};

      FB.Event.subscribe('auth.authResponseChange', function(response) {
                if (response && response.status == 'connected') {
                            alert('conectado');
                            sacarpostyguardar(paginas5minutos); //un ejemplo
                            //nose si esta funcion es la adecuada verificar si hay otra mejor para buscar cada cierto
                            //tiempo y que no se llene la pila de memoria ni sea tan lento (verificar)
                          //setTimeout(sacarpostyguardar(paginas5minutos),5*60*1000) //cada 5minutos
                          //setTimeout(sacarpostyguardar(paginas15minutos),*60*1000) cada 15min
                          //setTimeout(sacarpostyguardar(paginas60minutos),5*60*1000) //cada hora
                          //para el ultimo habra que poner un rango de hora verificar 2 veces al dia tal vez es diferente hay q modificar la funcion
                          //setTimeout(sacarpostyguardar(paginasdia,5),5*60*1000) //sacar entre 5 al dia pero nosabemos la hora pueden colocarlo todos juntos o uno por uno


                }
        });
   }

  });
});
</script>


</body>
</html>
